<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>H·ªçc t·ª´ v·ª±ng ti·∫øng Anh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="app-shell">
    <div class="app">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div>
                <div class="logo-block">
                    <div class="logo-icon">En</div>
                    <div>
                        <div class="logo-text-main">English Vocab Lab</div>
                        <div class="logo-text-sub">S·ªï tay t·ª´ v·ª±ng pastel c·ªßa ri√™ng b·∫°n</div>
                    </div>
                </div>

                <div class="streak-pill">
                    <span class="streak-dot"></span>
                    <span id="streak-text">Chu·ªói ng√†y h·ªçc: <b>0 ng√†y</b></span>
                </div>

                <div class="nav">
                <button class="nav-button active" onclick="showSection('vocab')">
                üìö T·ª´ v·ª±ng
                </button>
                <button class="nav-button" onclick="showSection('review')">
                üß† √în t·∫≠p
                </button>
                </div>

                <div class="goal-card">
                    <h3>M·ª•c ti√™u h√¥m nay</h3>
                    <p>Th√™m √≠t nh·∫•t <b>5 t·ª´ m·ªõi</b> v√† √¥n l·∫°i t·ª´ ƒë√£ l∆∞u. H·ªçc ƒë·ªÅu m·ªói ng√†y s·∫Ω nh·ªõ r·∫•t l√¢u üîÅ</p>
                    <div class="goal-chip-row">
                        <span class="goal-chip">+3 t·ª´ ƒë∆°n</span>
                        <span class="goal-chip">+2 c·ª•m t·ª´</span>
                        <span class="goal-chip">√în 10 t·ª´ c≈©</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-bottom">
                <div class="account-card">
                    <div class="account-label">T√†i kho·∫£n</div>
                    <div class="user-pill" id="user-display">Ch∆∞a ƒëƒÉng nh·∫≠p</div>
                    <div class="account-actions">
                        <button class="btn-ghost full-width" id="change-password-button">üîë ƒê·ªïi m·∫≠t kh·∫©u</button>
                        <button class="btn-ghost full-width" id="logout-button">üö™ ƒêƒÉng xu·∫•t</button>
                    </div>
                </div>

                <div class="footer-note">
                    Tip: H√£y t·∫°o v√≠ d·ª• li√™n quan t·ªõi <b>cu·ªôc s·ªëng th·ª±c</b> (c√¥ng vi·ªác, game, ƒë·ªì ƒÉn...) ƒë·ªÉ nh·ªõ l√¢u h∆°n ‚ú®
                </div>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main">
            <header class="main-header">
                <div>
                    <div class="main-title">S·ªï tay t·ª´ v·ª±ng</div>
                    <div class="main-sub">
                        Th√™m ‚Äì l∆∞u ‚Äì √¥n l·∫°i t·ª´ v·ª±ng ti·∫øng Anh, d·ªØ li·ªáu l∆∞u tr√™n Google Sheets.
                    </div>
                </div>
                <div class="main-header-right">
                    <div class="pill" id="total-count-pill">
                        <span class="pill-dot"></span>
                        <span>0 t·ª´</span>
                    </div>
                    <button class="btn-ghost" id="reload-button">üîÑ T·∫£i l·∫°i t·ª´ Sheets</button>
                </div>
            </header>

            <!-- Th√™m t·ª´ m·ªõi -->
            <section class="card">
                <div class="card-header-row">
                    <div>
                        <div class="card-title">Th√™m t·ª´ m·ªõi</div>
                        <p class="card-description">
                            ƒêi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ho·∫∑c d√πng ü§ñ AI ƒë·ªÉ g·ª£i √Ω. Date Added s·∫Ω ƒë∆∞·ª£c t·∫°o tr√™n Google Sheets.
                        </p>
                    </div>
                    <span class="badge">Ngu·ªìn d·ªØ li·ªáu ch√≠nh: Google Sheets</span>
                </div>

                <form id="word-form">
                    <div class="form-grid">
                        <div class="form-field">
                            <label for="word">Word *</label>
                            <input id="word" type="text" placeholder="vd: apple" required />
                            <button id="ai-suggest-button" type="button" class="btn-ghost ai-btn">
                                ü§ñ AI g·ª£i √Ω n·ªôi dung
                            </button>
                        </div>

                        <div class="form-field">
                            <label for="meaning">Meaning *</label>
                            <input id="meaning" type="text" placeholder="vd: qu·∫£ t√°o" required />
                        </div>

                        <div class="form-field">
                            <label for="folder">Folder (nh√≥m / ch·ªß ƒë·ªÅ)</label>
                            <input type="text" id="folder" placeholder="Folder..." list="folder-list" />
                            <datalist id="folder-list"></datalist>
                        </div>

                        <div class="form-field">
                            <label for="ipa">Pronunciation (IPA)</label>
                            <input id="ipa" type="text" placeholder="vd: /Àà√¶p.…ôl/" />
                        </div>

                        <div class="form-field">
                            <label for="type">Type</label>
                            <input id="type" type="text" placeholder="vd: noun, verb..." />
                        </div>

                        <div class="form-field">
                            <label for="status">Status</label>
                            <select id="status">
                                <option value="new">new</option>
                                <option value="learning">learning</option>
                                <option value="review">review</option>
                                <option value="mastered">mastered</option>
                            </select>
                        </div>

                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label for="sentence">Sentence</label>
                            <textarea id="sentence" placeholder="vd: I eat an apple every morning."></textarea>
                        </div>
                    </div>

                    <button class="btn-primary" type="submit" id="word-submit-button">
                        + Th√™m v√†o Google Sheets
                    </button>
                    <button class="btn-ghost" type="button" id="cancel-edit-button" style="display:none;">
                        H·ªßy s·ª≠a
                    </button>
                    <span id="edit-hint" class="edit-hint" style="display:none; margin-left:6px;">
                        ƒêang s·ª≠a m·ªôt t·ª´ ƒë√£ l∆∞u...
                    </span>
                </form>
            </section>

            <!-- Danh s√°ch t·ª´ -->
            <section class="card">
                <div class="card-header-row">
                    <div>
                        <div class="card-title">Danh s√°ch t·ª´ v·ª±ng</div>
                        <p class="card-description">
                            D·ªØ li·ªáu ƒë∆∞·ª£c load t·ª´ Google Sheets. C√≥ th·ªÉ t√¨m ki·∫øm, nghe ph√°t √¢m, s·ª≠a / x√≥a.
                        </p>
                    </div>
                    <div>
                        <input id="search-input" type="text"
                               placeholder="üîç T√¨m Word / Meaning / Folder..."
                               style="padding:6px 8px;border-radius:999px;border:1px solid #e5e7eb;font-size:12px;" />
                    </div>
                </div>
                 <div class="folder-filter-row" id="folder-filter-row"></div>
                <div class="word-list" id="word-list">
                    <div class="word-row word-header">
                        <div>Word</div>
                        <div>IPA</div>
                        <div>Meaning</div>
                        <div>Sentence</div>
                        <div>Type</div>
                        <div>Folder</div>
                        <div>Status</div>
                        <div>Actions</div>
                    </div>
                    <div class="word-empty" id="word-empty">
                        Ch∆∞a c√≥ t·ª´ n√†o ho·∫∑c ch∆∞a load ƒë∆∞·ª£c d·ªØ li·ªáu.
                        H√£y b·∫•m "T·∫£i l·∫°i t·ª´ Sheets" ho·∫∑c th√™m t·ª´ m·ªõi.
                    </div>
                </div>
                <div class="pagination" id="pagination"></div>
            </section>
        <section id="review-section" class="card" style="display:none;">
            
            <div id="review-menu">
                <div class="card-header-row">
                    <div class="card-title">Trung t√¢m √¥n t·∫≠p</div>
                    <p class="card-description">Ch·ªçn ph∆∞∆°ng ph√°p b·∫°n mu·ªën h·ªçc h√¥m nay</p>
                </div>
                
                <div class="review-grid">
                    <div class="review-option-card" onclick="startReviewSetup('flashcard')">
                        <div class="review-icon">üé¥</div>
                        <div class="review-info">
                            <h3>Flashcards</h3>
                            <p>L·∫≠t th·∫ª ki·ªÉm tra tr√≠ nh·ªõ.</p>
                        </div>
                    </div>

                    <div class="review-option-card" onclick="startReviewSetup('fill')">
                        <div class="review-icon">‚úçÔ∏è</div>
                        <div class="review-info">
                            <h3>ƒêi·ªÅn t·ª´</h3>
                            <p>Nh√¨n nghƒ©a, g√µ t·ª´ ti·∫øng Anh.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="review-folder-selection" style="display:none; text-align:center; padding: 20px 0;">
                <div class="card-title" style="margin-bottom:12px;">B·∫°n mu·ªën √¥n ch·ªß ƒë·ªÅ n√†o?</div>
                
                <div style="max-width: 300px; margin: 0 auto 20px;">
                    <label style="display:block; text-align:left; font-size:12px; margin-bottom:4px; color:#6b7280;">Ch·ªçn Folder:</label>
                    <select id="review-folder-select" style="width:100%; padding:10px; border-radius:12px; border:1px solid #d1d5db; outline:none;">
                        </select>
                </div>

                <div class="review-actions" style="justify-content:center; gap:10px; display:flex;">
                    <button class="btn-ghost" onclick="backToReviewMenu()">Quay l·∫°i</button>
                    <button class="btn-primary" onclick="confirmStartGame()">üöÄ B·∫Øt ƒë·∫ßu ngay</button>
                </div>
            </div>

            <div id="mode-flashcard" style="display:none;">
                <button class="btn-ghost" onclick="backToReviewFolder()">‚Üê Ch·ªçn l·∫°i ch·ªß ƒë·ªÅ</button>
                <div class="flashcard-container">
                    <div class="flashcard-scene">
                        <div class="flashcard" id="flashcard-el" onclick="flipCard()">
                            <div class="flashcard-face flashcard-front">
                                <h2 id="fc-word">Word</h2>
                                <p id="fc-ipa" style="color:#6b7280;">/ipa/</p>
                                <div class="tap-hint">Ch·∫°m ƒë·ªÉ l·∫≠t</div>
                            </div>
                            <div class="flashcard-face flashcard-back">
                                <div id="fc-meaning" style="font-weight:600; font-size:18px;">Nghƒ©a</div>
                                <p id="fc-sentence" style="margin-top:8px; font-style:italic; color:#4b5563;">Sentence</p>
                            </div>
                        </div>
                    </div>
                    <div class="review-controls">
                        <button class="btn-ghost" onclick="prevFlashcard()">Tr∆∞·ªõc</button>
                        <span id="fc-progress">0/0</span>
                        <button class="btn-primary" onclick="nextFlashcard()">Ti·∫øp theo ‚Üí</button>
                    </div>
                </div>
            </div>

            <div id="mode-fill" style="display:none;">
                <button class="btn-ghost" onclick="backToReviewFolder()">‚Üê Ch·ªçn l·∫°i ch·ªß ƒë·ªÅ</button>
                <div class="fill-game-container">
                    <div class="question-box">
                        <div class="q-label">Nghƒ©a ti·∫øng Vi·ªát:</div>
                        <div id="fill-meaning" class="q-text">...</div>
                        <div class="q-label" style="margin-top:12px;">Ch·ªß ƒë·ªÅ: <span id="fill-folder" style="font-weight:normal">...</span></div>
                    </div>
                    <div class="answer-box">
                        <input type="text" id="fill-input" placeholder="G√µ t·ª´ ti·∫øng Anh..." autocomplete="off" />
                        <button class="btn-primary" onclick="checkFillAnswer()">Check</button>
                    </div>
                    <div id="fill-feedback" class="feedback-msg"></div>
                    <div class="review-controls" style="justify-content: center; margin-top:20px;">
                        <button class="btn-ghost" onclick="nextFillQuestion()">C√¢u ti·∫øp theo ‚Üí</button>
                    </div>
                </div>
            </div>

        </section>

        </main>
    </div>
</div>

<!-- Modal ƒë·ªïi m·∫≠t kh·∫©u -->
<div class="modal-backdrop" id="change-password-modal" style="display:none;">
    <div class="modal-card">
        <div class="modal-title">ƒê·ªïi m·∫≠t kh·∫©u</div>
        <p class="modal-sub">M·∫≠t kh·∫©u s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t cho t√†i kho·∫£n ƒëang ƒëƒÉng nh·∫≠p.</p>

        <form id="change-password-form" class="modal-form">
            <div class="form-field">
                <label for="old-password">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                <input type="password" id="old-password" autocomplete="current-password" />
            </div>
            <div class="form-field">
                <label for="new-password">M·∫≠t kh·∫©u m·ªõi</label>
                <input type="password" id="new-password" autocomplete="new-password" />
            </div>
            <div class="form-field">
                <label for="confirm-password">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi</label>
                <input type="password" id="confirm-password" autocomplete="new-password" />
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-ghost" id="cancel-change-password">H·ªßy</button>
                <button type="submit" class="btn-primary">L∆∞u m·∫≠t kh·∫©u</button>
            </div>

            <div id="change-password-message" class="modal-message"></div>
        </form>
    </div>
</div>

<!-- Popup AI spinner -->
<div class="modal-backdrop" id="ai-modal" style="display:none;">
    <div class="ai-card">
        <div class="ai-title">ü§ñ Gemini ƒëang g·ª£i √Ω...</div>
        <div class="ai-body">
            <div class="ai-spinner"></div>
            <div>
                <div id="ai-word-label" class="ai-word-label"></div>
                <div class="ai-text">
                    ƒêang t·∫°o IPA, nghƒ©a ti·∫øng Vi·ªát, c√¢u v√≠ d·ª• v√† lo·∫°i t·ª´. Th∆∞·ªùng ch·ªâ v√†i gi√¢y üí´
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Popup nh·∫≠p Gemini key -->
<div class="modal-backdrop" id="gemini-key-modal" style="display:none;">
    <div class="modal-card">
        <div class="modal-title">Thi·∫øt l·∫≠p Gemini API key</div>
        <p class="modal-sub">
            D√°n Gemini API key ƒë√£ ƒë∆∞·ª£c c·∫•p. H·ªá th·ªëng s·∫Ω ki·ªÉm tra tr√πng v·ªõi <b>c·ªôt C</b> trong sheet <b>Users</b>.
        </p>

        <form id="gemini-key-form" class="modal-form">
            <div class="form-field">
                <label for="gemini-key-input">Gemini API key</label>
                <input type="text" id="gemini-key-input" autocomplete="off" />
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-ghost" id="cancel-gemini-key">H·ªßy</button>
                <button type="submit" class="btn-primary">L∆∞u key</button>
            </div>

            <div id="gemini-key-message" class="modal-message"></div>
        </form>
    </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<script src="main.js"></script>
</body>
</html>
